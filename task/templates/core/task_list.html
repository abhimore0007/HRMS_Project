<h2>Task List</h2>
{% if user.is_staff %}
    <a href="{% url 'task_create' %}">Create Task</a>
    <a href="{% url 'assign_task' %}">Assign Task</a>
{% endif %}

<!-- Tasks Table -->
<h3>All Tasks</h3>
<table border="1">
    <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Priority</th>
        <th>Start Date</th>
        <th>End Date</th>
        {% if user.is_staff %}<th>Actions</th>{% endif %}
    </tr>
    {% for task in tasks %}
    <tr>
        <td>{{ task.task_title }}</td>
        <td>{{ task.task_description }}</td>
        <td>{{ task.task_priority }}</td>
        <td>{{ task.start_date }}</td>
        <td>{{ task.end_date }}</td>
        {% if user.is_staff %}
        <td>
            {% if task.task_id %}
                <a href="{% url 'task_update' task.task_id %}">Edit</a> 
                <a href="{% url 'task_delete' task.task_id %}">Delete</a>
            {% else %}
                <span>Error: Task ID Missing</span>
            {% endif %}
        </td>
        {% endif %}
    </tr>
    {% empty %}
    <tr><td colspan="6">No tasks available</td></tr>
    {% endfor %}
</table>

<h3>Assigned Tasks</h3>
<table border="1">
    <tr>
        <th>Task</th>
        <th>Assigned Employee</th>
        <th>Status</th>
        <th>Assigned By</th>
        <th>Assigned Date</th>
        {% if not user.is_staff %}<th>Update Status</th>{% endif %}
    </tr>
    {% for assignment in assigned_tasks %}
    <tr>
        <td>{{ assignment.task.task_title }}</td>
        <td>{{ assignment.employee.first_name }} {{ assignment.employee.last_name }}</td>
        <td>{{ assignment.status }}</td>

        <!-- âœ… Fix: Show Admin name or assigned employee name -->
        <td>
            {% if assignment.assigned_by_name %}
                {{ assignment.assigned_by_name }}
            {% else %}
                {{ assignment.assigned_by.first_name }} {{ assignment.assigned_by.last_name }}
            {% endif %}
        </td>
        

        <td>{{ assignment.assigned_date }}</td>
        <td><a href="{% url 'update_task_status' assignment.assignment_id %}">Update</a></td>
    </tr>
    {% empty %}
    <tr><td colspan="6">No tasks assigned yet.</td></tr>
    {% endfor %}
</table>
